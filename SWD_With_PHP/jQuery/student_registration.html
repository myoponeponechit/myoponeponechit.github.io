<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Registration</title>
</head>
<body>
    <div id="addNewStudent">
        <h3>Add New Student</h3>
            Name : <input type="text" name="name" id="name"><br>
            Email : <input type="email" name="email" id="email"><br>
            Phone : <input type="number" name="phone" id="phone"><br>
            Year : <select name="year" id="year">
                <option value="">Choose Year</option>
                <option value="First Year">First Year</option>
                <option value="Second Year">Second Year</option>
                <option value="Third Year">Third Year</option>
            </select><br>
            <button id="add">Add Student</button>
    </div>

    <div id="updStudent">
        <h3>Update Student</h3>
        <input type="hidden" name="id" id="index">
            Name : <input type="text" name="name" id="edit_name"><br>
            Email : <input type="email" name="email" id="edit_email"><br>
            Phone : <input type="number" name="phone" id="edit_phone"><br>
            Year : <select name="year" id="edit_year">
                <option value="">Choose Year</option>
                <option value="First Year">First Year</option>
                <option value="Second Year">Second Year</option>
                <option value="Third Year">Third Year</option>
            </select><br>
            <button id="update">Update Student</button>
    </div>
    <h3>Student List</h3>
        <table border="1" cellpadding = "20" cellspacing = "0">
            <tr>
                <th>No.</th>
                <th>Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Year</th>
                <th>Action</th>
            </tr>
            <tbody id="tbody">
                
            </tbody>
        </table>
    <script src="jquery.min.js"></script>
    <script>
        $(document).ready(function(){
            function getData(){
                let stuString = localStorage.getItem("students");
                if(stuString){
                    let stuArray = JSON.parse(stuString);
                    let data = '';
                    let j = 1;
                     $.each(stuArray, function(i, v){
                        data += `<tr>
                        <td>${j++}</td>
                        <td>${v.stu_name}</td>
                        <td>${v.stu_email}</td>
                        <td>${v.stu_phone}</td>
                        <td>${v.stu_year}</td>
                        <td><button class = "edit" data-id="${i}" data-name="${v.name}" data-email="${v.email}" data-phone="${v.phone}" data-year="${v.year}">Edit</button>&nbsp;
                        <button class="delete" data-id="${i}">Delete</button></td>
                        </tr>`;
                     });
                     $('#tbody').html(data);
                }
            }
            getData();
            $('#updStudent').hide();
            $('#add').click(function(){
                let name = $('#name').val();
                let email = $('#email').val();
                let phone = $('#phone').val();
                let year = $('#year').val();

                let students_obj = {
                    stu_name : name,
                    stu_email : email,
                    stu_phone : phone,
                    stu_year : year
                };
                console.log(students_obj);

                let stuString = localStorage.getItem("students");
                let stuArray;
                if(stuString == null) {
                    stuArray = [];
                }else{
                    stuArray = JSON.parse(stuString);
                }

                stuArray.push(students_obj);
                // console.log(stuArray);

                let stuData = JSON.stringify(stuArray);

                localStorage.setItem("students", stuData);

                getData();

            });
            
            $('#tbody').on('click','.delete', function(){
                let id = $(this).data('id');
                console.log(id);

                let ans = confirm("Are you sure want to delete?");
                console.log(ans);

                if(ans){
                    let stuString = localStorage.getItem('students');
                    console.log(stuString);
                    
                    if(stuString){
                        let stuArray = JSON.parse(stuString);
                        console.log(stuArray);

                        stuArray.splice(id,1);
                        console.log(stuArray);

                        let stuData = JSON.stringify(stuArray);
                        localStorage.setItem('students',stuData);

                        getData();
                    }
                }
            });

            $('#tbody').on('click','.edit', function(){
                $('#addNewStudent').hide();
                $('#updStudent').show();

                let id = $(this).data('index');
                let name = $(this).data('name');
                let email = $(this).data('email');
                let phone = $(this).data('phone');
                let year = $(this).data('year');
                console.log(id,name,email,phone,year);

                $('#edit_name').val(name);
                $('#edit_email').val(email);
                $('#edit_phone').val(phone);
                $('#edit_year').val(year);
            })

            $('#update').click(function(){
                let upd_index = $('#index').val();
                let upd_name = $('#edit_name').val();
                let upd_email = $('#edit_email').val();
                let upd_phone = $('#edit_phone').val();
                let upd_year = $('#edit_year').val();

                let stuString = localStorage.getItem('students');
                let stuArray = JSON.parse(stuString);
                if(stuString){
                    stuArray[upd_index].stu_name = upd_name;
                    stuArray[upd_index].stu_email = upd_email;
                    stuArray[upd_index].stu_phone = upd_phone;
                    stuArray[upd_index].stu_year = upd_year;

                    let stuData = JSON.stringify(stuArray);
                    localStorage.setItem('students',stuData);

                    getData();
                }
            })
        });
    </script>
</body>
</html>